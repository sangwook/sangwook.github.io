<!DOCTYPE html>
<html lang="ko">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  
  
  
  

  <meta name="title"       content="OpenSSL 취약점. Heartbleed" />
  <meta name="author"      content="이상욱"/>
  <meta name="description" content="“Heartbleed(심장 출혈)”라고 부르는 버그를 이용하면 최근 2년동안의 OpenSSL 버전이 설치된 시스템 메모리의 64KB 데이터를 공격자가 볼 수 있다. 정확한 취약성 이름은: CVE-2014-0160 OpenSSL Heartbleed 시스템 메모리에는 유저이름, 암호,..."/>

  <meta name="og:site_name"    content="이상욱"/>
  <meta name="og:type"         content="article"/>
  <meta name="og:title"        content="OpenSSL 취약점. Heartbleed"/>
  <meta name="og:description"  content="“Heartbleed(심장 출혈)”라고 부르는 버그를 이용하면 최근 2년동안의 OpenSSL 버전이 설치된 시스템 메모리의 64KB 데이터를 공격자가 볼 수 있다. 정확한 취약성 이름은: CVE-2014-0160 OpenSSL Heartbleed 시스템 메모리에는 유저이름, 암호,..."/>
  <meta name="og:url"          content="https://sangwook.github.io/2014/04/08/openssl-heartbeat-heartbleed.html"/>
  <meta name="og:image"        content="https://sangwook.github.io/assets/2016/161011-ubuntu16-screenfetch-d309a0fce49f7abaf5a95f61a72481466e2187b8b361c52f334b03de5a55c92d.jpg"/>
  <meta name="og:image:width"  content="960"/>
  <meta name="og:image:height" content="436"/>

  <meta name="twitter:card"        content="summary_large_image"/>
  <meta name="twitter:site"        content="@yiisw">
  <meta name="twitter:creator"     content="@yiisw">
  <meta name="twitter:title"       content="OpenSSL 취약점. Heartbleed"/>
  <meta name="twitter:description" content="“Heartbleed(심장 출혈)”라고 부르는 버그를 이용하면 최근 2년동안의 OpenSSL 버전이 설치된 시스템 메모리의 64KB 데이터를 공격자가 볼 수 있다. 정확한 취약성 이름은: CVE-2014-0160 OpenSSL Heartbleed 시스템 메모리에는 유저이름, 암호,..."/>
  <meta name="twitter:image"       content="https://sangwook.github.io/assets/2016/161011-ubuntu16-screenfetch-d309a0fce49f7abaf5a95f61a72481466e2187b8b361c52f334b03de5a55c92d.jpg">

  <title>OpenSSL 취약점. Heartbleed</title>

  <link type="text/css" rel="stylesheet" href="/assets/main-caae314880d485d51225e30ff81b77cd77bf8582dcd712eda64afdc9c886713c.css">
  <link rel="alternate" type="application/rss+xml" title="이상욱" href="http://feeds.feedburner.com/sangwook">
  <link rel="shortcut icon" href="https://avatars0.githubusercontent.com/u/123514?s=100">
</head>

  <body>
    <header class="site-header" role="banner">

  <div class="wrapper">

    <a href="/" title="sangwook">
      <span style="background-image: url('https://avatars0.githubusercontent.com/u/123514?s=100'); width:100px; height:100px; display:block;">
      </span>
    </a>

    <div class="about-desc">
      이상욱,
      scott,
      ISFP,
      <a href="https://www.facebook.com/2sangwook">facebook</a>,
      <a href="https://twitter.com/yiisw">twitter</a>,
      <a href="https://github.com/sangwook">github</a>,
      <a href="https://open.kakao.com/o/sUbQmYl">카카오톡</a>,
      <a href="https://blog.naver.com/yiisw">네이버</a>,
      <a class="page-link" href="http://feeds.feedburner.com/sangwook">RSS</a>
    </div>

  </div>

</header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">OpenSSL 취약점. Heartbleed</h1>
    <p class="post-meta"><time datetime="2014-04-08T11:44:00+09:00" itemprop="datePublished">2014-04-08</time>
     <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="name" itemprop="name">이상욱</span></span></p>
  </header>
  <div class="post-content" itemprop="articleBody">
    <ul>
  <li>“Heartbleed(심장 출혈)”라고 부르는 버그를 이용하면 최근 2년동안의 OpenSSL 버전이 설치된 시스템 메모리의 64KB 데이터를 공격자가 볼 수 있다.
    <ul>
      <li>정확한 취약성 이름은: CVE-2014-0160 OpenSSL Heartbleed</li>
      <li>시스템 메모리에는 유저이름, 암호, 신용카드 정보 등의 데이터가 있고. 이것을 키를 이용해서 암호화한다.</li>
      <li>이 키를 공격자가 얻을 수 있고. 암호화되지 않은 상태로 읽을 수 있다.</li>
      <li>그리고 이 키를 가지고 다른 사람 행세를 하며 서버에 침입할 수 있다.</li>
    </ul>
  </li>
</ul>

<h3 id="구체적인-공격-가능성은">구체적인 공격 가능성은:</h3>

<ul>
  <li>공격자가 https 서버의 SSL인증서 개인키를 얻을 수 있다.</li>
  <li><a href="https://twitter.com/1njected/statuses/453797877672706048">FreeBSD 9.1에서 개인키가 보인 사례</a>
    <ul>
      <li>이건 최악의 경우긴 한데. 현재 사용중인 SSL인증서를 revoke하고 재발행하는게 좋다.</li>
      <li>만약 현재 운영하는 서버가 취약성있는 버전의 OpenSSL에서 서비스하고 있었다면. 최근 2년동안 SSL 인증서의 개인키가 털렸을 가능성이 있다.</li>
    </ul>
  </li>
  <li>https 서버의 메모리에 있는 사용자 정보가 노출될 수 있다. 만약 아파치에서 SSL을 처리하고 있다면 웹 어플리케이션 정보가 노출될 수 있다.
    <ul>
      <li><a href="https://twitter.com/markloman/statuses/453502888447586304">yahoo.com에서 다른사람의 아이디, 비밀번호가 노출되는 사례</a></li>
    </ul>
  </li>
  <li><a href="https://news.ycombinator.com/item?id=7553882">heartbleed 취약성을 이용하여 유저 세션을 하이재킹하는 방법</a></li>
</ul>

<h3 id="버그-분석">버그 분석</h3>

<ul>
  <li>TLS 스펙의 문제는 아니고 TLS heartbeat 기능을 OpenSSL 라이브러리가 잘못 구현한 버그이다.
    <ul>
      <li>heartbeat 구현 버그라서 Heartbleed 라고 이름 붙여짐.</li>
      <li><a href="http://blog.existentialize.com/diagnosis-of-the-openssl-heartbleed-bug.html">실제 수정한 소스코드 분석은 여기서</a></li>
      <li>TLS Heartbeat 스펙은
        <ul>
          <li>payload 와 payload length 를 받아서.</li>
          <li>length 를 검사하고 payload를 그대로 복사하여 클라이언트에게 응답해야 한다.</li>
          <li>하지만 OpenSSL이 payload length 검사 없이 memcpy 를 실행해서 메모리 안의 다른 내용까지 복사해서 응답해주는 버그였다.</li>
          <li><a href="https://github.com/openssl/openssl/commit/96db9023b881d7cd9f379b0c154650d6c108e9a3">https://github.com/openssl/openssl/commit/96db9023b881d7cd9f379b0c154650d6c108e9a3</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>2011년 12월 이후 버전. OpenSSL 1.0.1 ~ 1.0.1f 에 문제가 있고 오늘(4/7) 수정되었다.</li>
  <li>게다가 이 버그를 악용해도 로그에 남지 않는다.</li>
</ul>

<h3 id="내-사이트가-영향이-있는지-체크하는-방법">내 사이트가 영향이 있는지 체크하는 방법</h3>

<ul>
  <li>아래의 사이트에서 해당 웹서버가 영향을 받는지 아닌지 테스트할 수 있다.
    <ul>
      <li><a href="http://filippo.io/Heartbleed/#github.com">http://filippo.io/Heartbleed/#github.com</a></li>
      <li>이 사이트의 소스코드는 <a href="https://github.com/FiloSottile/Heartbleed">https://github.com/FiloSottile/Heartbleed</a> 여기 있는데, go로 작성되어 있다.</li>
    </ul>
  </li>
  <li><a href="https://blog.ipredator.se/2014/04/how-to-test-if-your-openssl-heartbleeds.html">How to test if your OpenSSL heartbleeds</a>
    <ul>
      <li>이 블로그를 보고 직접 서버에서 테스트 할 수도 있다.</li>
    </ul>
  </li>
  <li><a href="https://chrome.google.com/webstore/detail/chromebleed/eeoekjnjgppnaegdjbcafdggilajhpic/details">Chromebleed 라는 크롬 확장</a>도 나왔다.
    <ul>
      <li>현재 브라우징 하고 있는 사이트가 heartbleed 위험이 있는지 보여줌.</li>
      <li>(사실 이런 확장들이 위험이 있는 사이트들을 수집하고 있는게 아닌가 의심도..)</li>
    </ul>
  </li>
  <li><a href="https://github.com/musalbas/heartbleed-masstest">파이썬으로 작성된 테스트 스크립트. heartbleed-masstest</a></li>
</ul>

<p>OpenSSL 1.0.1 ~ 1.0.1f 을 사용하지 않으면 안전하다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sangwook@main:~$ openssl version -a
OpenSSL 1.0.1 14 Mar 2012
</code></pre>
</div>

<h3 id="aws-ec2-에서-대응하는-방법">AWS EC2 에서 대응하는 방법</h3>

<p>Amazon Linux에서 아래의 명령 후 서비스 restart</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo yum clean all 
sudo yum update OpenSSL
</code></pre>
</div>

<p>ELB에서 SSL termination을 사용하는 경우 취약점이 여전히 있음. 관련 이슈는 아래의 링크들에서..</p>

<ul>
  <li><a href="https://forums.aws.amazon.com/thread.jspa?threadID=149690">is AWS Elastic Load Balancing affected by the HeartBleed BUG</a></li>
  <li><a href="https://forums.aws.amazon.com/thread.jspa?messageID=535185&amp;#535185">Heartbleed Load Balancer Vulnerability CVE-2014-0160</a></li>
</ul>

<h3 id="ubuntu-에서-대응하는-방법">Ubuntu 에서 대응하는 방법</h3>

<p><a href="http://www.ubuntu.com/usn/usn-2165-1/">http://www.ubuntu.com/usn/usn-2165-1/</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get update
sudo apt-get upgrade
</code></pre>
</div>

<p>또는</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get update
sudo apt-get install libssl1.0.0
</code></pre>
</div>

<h3 id="nodejs-에서-대응">Node.js 에서 대응</h3>

<ul>
  <li>Node.js v0.10.2 이상, v0.8 이라면 취약성 없음.</li>
  <li>OPENSSL_NO_HEARTBEATS 이 설정된 상태로 heartbeat기능이 disable 상태.</li>
  <li><a href="https://twitter.com/nodejs/status/453298698714230784">https://twitter.com/nodejs/status/453298698714230784</a></li>
  <li><a href="https://github.com/joyent/node/commit/28c6e42e">https://github.com/joyent/node/commit/28c6e42e</a>
    <ul>
      <li>“의도하지 않은 보안 기능”이라는 댓글이 인상깊다.</li>
    </ul>
  </li>
</ul>

<h3 id="테크-기업들의-대응들">테크 기업들의 대응들</h3>

<ul>
  <li><a href="http://staff.tumblr.com/post/82113034874/urgent-security-update">텀블러의 대응</a>
    <ul>
      <li><a href="http://hangulteam.tumblr.com/post/82367290094">텀블러 한글 블로그에도 “긴급 보안 업데이트” 라는 제목의 글 올라옴</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/blog/1818-security-heartbleed-vulnerability">GitHub의 대응</a></li>
  <li><a href="https://blog.heroku.com/archives/2014/4/8/openssl_heartbleed_security_update">heroku의 대응</a></li>
</ul>

<h3 id="링크">링크</h3>

<ul>
  <li><a href="https://techcrunch.com/2014/04/07/massive-security-bug-in-openssl-could-effect-a-huge-chunk-of-the-internet/">테크크런치 기사 Massive Security Bug In OpenSSL Could Affect A Huge Chunk Of The Internet - TechCrunch</a></li>
  <li><a href="http://heartbleed.com/">heartbleed</a></li>
  <li><a href="https://news.ycombinator.com/item?id=7548991">해커뉴스 스레드</a></li>
  <li><a href="https://xkcd.com/1353/">xkcd 만화</a></li>
  <li><a href="http://kr.wsj.com/posts/2014/04/10/%EC%98%A4%EB%8A%98-%EB%8B%B9%EC%9E%A5-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8%EB%A5%BC-%EB%B0%94%EA%BF%94%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0/">오늘 당장 비밀번호를 바꿔야 하는 이유 - WSJ Korea - WSJ</a></li>
  <li><a href="http://xkcd.com/1354/">xkcd에서 쉽게 설명한 Heartbleed</a>. <img src="http://imgs.xkcd.com/comics/heartbleed_explanation.png" alt="" /></li>
</ul>


  </div>
  
</article>

      </div>
    </main>
    <footer class="site-footer">
  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col">
        이상욱,
        scott,
        ISFP,
        <a href="https://www.facebook.com/2sangwook">facebook</a>,
        <a href="https://twitter.com/yiisw">twitter</a>,
        <a href="https://github.com/sangwook">github</a>,
        <a href="https://open.kakao.com/o/sUbQmYl">카카오톡</a>,
        <a href="https://blog.naver.com/yiisw">네이버</a>,
        <a class="page-link" href="http://feeds.feedburner.com/sangwook">RSS</a>
      </div>

      <!-- <div class="footer-col footer-col-2"> -->
      <!--   <ul class="social-media-list"> -->
      <!--     <li> -->
      <!--     </li> -->
      <!--   </ul> -->
      <!-- </div> -->

      <!-- <div class="footer-col footer-col-3"> -->
      <!-- </div> -->
    </div>

  </div>
</footer>


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-26630011-3', 'auto');
  ga('send', 'pageview');
</script>



  </body>
</html>
